<p>正则表达式对我来说一直是一个不明觉厉的东西，但是由于在处理文本的时候是必须使用的，所以稍微明一下总是好的。由于平时使用R比较多，所以就以在R中使用正则表达式做一个笔记，这样以后忘记了的时候还可以查看。</p>

<p>以下主要参考的是Ben Forta的《正则表达式必知必会》的中文版，其他的正则表达式的教材大多很厚，到现在为止我就发现这本比较靠谱，希望大家有更加好的可以给我推荐，谢谢。</p>

<h1 id="r">R中怎么使用正则表达式</h1>
<p>在R中很多涉及到字符处理的函数都是可以使用正则表达式的，我们就以最正常字符处理函数为例：</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre><span class="n">regexec</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">ignore.case</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">fixed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">useBytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span><span class="c1"># pattern就是我们要写的正则表达式 text是需要处理的文本
# ignore.case表示是不是忽略大小写
# fixed为FALSE则使用正则表达式匹配，否则就使用精确匹配，也就是把'.'之类的字符当作实义字符
</span><span class="err">#</span><span class="w"> </span><span class="n">useBytes</span><span class="w"> </span><span class="err">暂时没有使用过</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>接下来都是在grep上使用正则表达式，其他的都是差不多的。</p>

<h1 id="r-1">R中使用正则表达式实战</h1>
<p>## 匹配纯文本</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"Hello ,my name is Ben.Please visit my website"</span><span class="w">
</span><span class="n">m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">regexec</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Ben"</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="n">regmatches</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">)</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [[1]]
## [1] "Ben"</code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># 全局匹配
</span><span class="n">m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">regexec</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"my"</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w">  </span><span class="c1">#注意只是给出第一个匹配的，要全局匹配需要使用gregexpr
</span><span class="n">regmatches</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [[1]]
## [1] "my"</code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gregexpr</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"my"</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="n">regmatches</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [[1]]
## [1] "my" "my"</code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># 不考虑字母大小写
</span><span class="n">m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gregexpr</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"My"</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">ignore.case</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">regmatches</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [[1]]
## [1] "my" "my"</code></pre></figure>

<h2 id="section">匹配任意字符</h2>
<p>正则表达式中使用点(.)来匹配一个 <strong>一个或者多个</strong> 字符，可以匹配任意单个字符串，包括点(.)本身。</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"sales.xls"</span><span class="p">,</span><span class="w"> </span><span class="s2">"orders3.xls"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sales2.xls"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sales3.xls"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sales.4.xls"</span><span class="p">,</span><span class="w"> 
    </span><span class="s2">"apac1.xls"</span><span class="p">,</span><span class="w"> </span><span class="s2">"na1.xls"</span><span class="p">,</span><span class="w"> </span><span class="s2">"na2.xls"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sa1.xls"</span><span class="p">)</span><span class="w">
</span><span class="n">grep</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"sales."</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] "sales.xls"   "sales2.xls"  "sales3.xls"  "sales.4.xls"</code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># 点(.)可以连着使用也可以分开使用
</span><span class="n">grep</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">".a."</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] "sales.xls"   "sales2.xls"  "sales3.xls"  "sales.4.xls" "apac1.xls"  
## [6] "na1.xls"     "na2.xls"     "sa1.xls"</code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">grep</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">".a.."</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] "sales.xls"   "sales2.xls"  "sales3.xls"  "sales.4.xls" "apac1.xls"  
## [6] "na1.xls"     "na2.xls"     "sa1.xls"</code></pre></figure>

<h2 id="section-1">匹配特殊字符</h2>
<p>匹配特殊字符需要进行转义，转义一般使用\，但是在R中我们使用\来表示，这个是需要注意的。还有一个需要注意的就是如果比需要表示\也是需要转义的。</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"sales.xls"</span><span class="p">,</span><span class="w"> </span><span class="s2">"orders3.xls"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sales2.xls"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sales3.xls"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sales.4.xls"</span><span class="p">,</span><span class="w"> 
    </span><span class="s2">"apac1.xls"</span><span class="p">,</span><span class="w"> </span><span class="s2">"na1.xls"</span><span class="p">,</span><span class="w"> </span><span class="s2">"na2.xls"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sa1.xls"</span><span class="p">)</span><span class="w">
</span><span class="n">grep</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">".a.\\."</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] "na1.xls" "na2.xls" "sa1.xls"</code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"a\\d"</span><span class="p">,</span><span class="w"> </span><span class="s2">"acd"</span><span class="p">,</span><span class="w"> </span><span class="s2">"dsa"</span><span class="p">)</span><span class="w">
</span><span class="n">grep</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"a\\\\"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">  </span><span class="err">#需要注意在</span><span class="n">R</span><span class="err">中，\本身是要用\\表示的</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] "a\\d"</code></pre></figure>

<h2 id="section-2">匹配一组字符</h2>
<p>我们需要的几个字符中的任意一个</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"sales.xls"</span><span class="p">,</span><span class="w"> </span><span class="s2">"orders3.xls"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sales2.xls"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sales3.xls"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sales.4.xls"</span><span class="p">,</span><span class="w"> 
    </span><span class="s2">"apac1.xls"</span><span class="p">,</span><span class="w"> </span><span class="s2">"na1.xls"</span><span class="p">,</span><span class="w"> </span><span class="s2">"na2.xls"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sa1.xls"</span><span class="p">)</span><span class="w">
</span><span class="c1"># 我们需要sa开是和na开始的
</span><span class="n">grep</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"[sn]a.\\.xls"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] "na1.xls" "na2.xls" "sa1.xls"</code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">text</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"The phrase regullar expression is often abbreciated as RegEx or regex"</span><span class="w">
</span><span class="n">m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gregexpr</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"[Rr]eg[Ee]x"</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">text</span><span class="p">)</span><span class="w">
</span><span class="n">regmatches</span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [[1]]
## [1] "RegEx" "regex"</code></pre></figure>

<h2 id="section-3">利用字符区间</h2>
<p>使用集合的时候对于有规律的我们可以使用区间来表示</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"sales.xls"</span><span class="p">,</span><span class="w"> </span><span class="s2">"orders3.xls"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sales2.xls"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sales3.xls"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sales.4.xls"</span><span class="p">,</span><span class="w"> 
    </span><span class="s2">"apac1.xls"</span><span class="p">,</span><span class="w"> </span><span class="s2">"na1.xls"</span><span class="p">,</span><span class="w"> </span><span class="s2">"na2.xls"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sa1.xls"</span><span class="p">)</span><span class="w">
</span><span class="n">grep</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"..[0123456789]\\.xls"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] "orders3.xls" "sales2.xls"  "sales3.xls"  "sales.4.xls" "apac1.xls"  
## [6] "na1.xls"     "na2.xls"     "sa1.xls"</code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">grep</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"..[0-9]\\.xls"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] "orders3.xls" "sales2.xls"  "sales3.xls"  "sales.4.xls" "apac1.xls"  
## [6] "na1.xls"     "na2.xls"     "sa1.xls"</code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">grep</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"..[0-2]\\.xls"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] "sales2.xls" "apac1.xls"  "na1.xls"    "na2.xls"    "sa1.xls"</code></pre></figure>

<p>这里只要是开始和结尾是合法的ASCII字符都是可以的，不过常用的还是字符区间和数字区间。</p>

<h2 id="section-4">取非匹配</h2>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"sales.xls"</span><span class="p">,</span><span class="w"> </span><span class="s2">"orders3.xls"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sales2.xls"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sales3.xls"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sales.4.xls"</span><span class="p">,</span><span class="w"> 
    </span><span class="s2">"apac1.xls"</span><span class="p">,</span><span class="w"> </span><span class="s2">"na1.xls"</span><span class="p">,</span><span class="w"> </span><span class="s2">"na2.xls"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sa1.xls"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sam.xls"</span><span class="p">)</span><span class="w">
</span><span class="n">grep</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"..[^0123456789]\\.xls"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] "sales.xls" "sam.xls"</code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">grep</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"[ns]a[^0-9]\\.xls"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] "sam.xls"</code></pre></figure>

<h2 id="section-5">匹配空白字符</h2>
<p>空白字符有换页符\f，换行符\n，回车符\r，制表符\t，垂直制表符\v。
在匹配的时候记得转义就好了</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">text</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"I am Justin\nHello   world\n"</span><span class="w">  </span><span class="c1">#在justin和world之间换行了
</span><span class="n">m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gregexpr</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"\n.*"</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">text</span><span class="p">)</span><span class="w">
</span><span class="n">regmatches</span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [[1]]
## [1] "\nHello   world\n"</code></pre></figure>

<h2 id="section-6">匹配特定的字符类型</h2>
<p>### 匹配数字
可以使用[0-9]来匹配数字，也可以使用\d来匹配数字使用\D来匹配非数字,但是在R中我们要使用\d和\D来替代</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"sales.xls"</span><span class="p">,</span><span class="w"> </span><span class="s2">"orders3.xls"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sales2.xls"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sales3.xls"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sales.4.xls"</span><span class="p">,</span><span class="w"> 
    </span><span class="s2">"apac1.xls"</span><span class="p">,</span><span class="w"> </span><span class="s2">"na1.xls"</span><span class="p">,</span><span class="w"> </span><span class="s2">"na2.xls"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sa1.xls"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sam.xls"</span><span class="p">)</span><span class="w">
</span><span class="n">grep</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"..\\d\\.xls"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] "orders3.xls" "sales2.xls"  "sales3.xls"  "sales.4.xls" "apac1.xls"  
## [6] "na1.xls"     "na2.xls"     "sa1.xls"</code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">grep</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"..\\D\\.xls"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] "sales.xls" "sam.xls"</code></pre></figure>

<h3 id="section-7">匹配字母和数字</h3>
<p>匹配所有的字母和数字，用\w表示，等价于[0-9a-zA-Z]我们用\W表示非字母和数字。</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">text</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"\n11213\nA1C2E3\n48075\nM184F2\n90046\nH1H2H2\n"</span><span class="w">
</span><span class="n">m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gregexpr</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"\\w\\d\\w\\d\\w\\d"</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">text</span><span class="p">)</span><span class="w">
</span><span class="n">regmatches</span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [[1]]
## [1] "A1C2E3" "M184F2" "H1H2H2"</code></pre></figure>

<h3 id="section-8">匹配空白字符</h3>
<p>\s，包含我们上面提到的所有的空白字符
### 匹配十六进制和八进制数值
使用\x0后跟十六进制数，\0后面跟八进制数</p>

<h2 id="posix">使用POSIX字符类</h2>
<p>可以在R的帮助文档查看那些可以使用的</p>

<h2 id="section-9">匹配一个或者多个字符</h2>
<p>使用加号(“+”)来匹配一个或者多个字符</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">text</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"Send personal emain to ben@forta.com or spam@gmail.com"</span><span class="w">
</span><span class="n">m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gregexpr</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"\\w+@\\w+\\.\\w+"</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">text</span><span class="p">)</span><span class="w">
</span><span class="n">regmatches</span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [[1]]
## [1] "ben@forta.com"  "spam@gmail.com"</code></pre></figure>

<h2 id="section-10">匹配零个或者多个字符</h2>
<p>使用星号(*)来匹配零个或者多个字符</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">text</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"Hello ben@forta.com is my email address"</span><span class="w">
</span><span class="n">m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gregexpr</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"\\w+[\\w.]*@\\w+\\.\\w+"</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">text</span><span class="p">)</span><span class="w">
</span><span class="n">regmatches</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [[1]]
## [1] "ben@forta.com"</code></pre></figure>

<h2 id="section-11">匹配零个或者一个字符</h2>
<p>使用问号(?)来匹配零个或者一个字符</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">text</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"The URL is http://www.forta.com/,to connec securely use https://www.forta.com/ instead"</span><span class="w">
</span><span class="n">m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gregexpr</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"https?://[\\w./]+"</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">perl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">  </span><span class="c1">#注意perl参数的设置的结果的差异
</span><span class="n">regmatches</span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [[1]]
## [1] "http://www.forta.com/"  "https://www.forta.com/"</code></pre></figure>

<h2 id="section-12">重复精确的次数</h2>
<p>用大括号({})中写上数字来表示重复的次数</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">text</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"&lt;BOdy BGCOLOR=\"#336633\",TEXT=\"#FFFFFF\",MARGINWIDTH=\"0\"&gt;"</span><span class="w">
</span><span class="n">m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gregexpr</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"[[:xdigit:]]{6}"</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">text</span><span class="p">)</span><span class="w">
</span><span class="n">regmatches</span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [[1]]
## [1] "336633" "FFFFFF"</code></pre></figure>

<h2 id="section-13">为重复设置一个区间</h2>
<p>用大括号中写上范围({2,5})表示写重复的次数的范围</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">text</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"4/8/03\n10-6-2004\n2/2/2\n01-01-01\n"</span><span class="w">
</span><span class="n">m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gregexpr</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"\\d{1,2}[-/]\\d{1,2}[-/]\\d{2,4}"</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">text</span><span class="p">,</span><span class="w"> 
    </span><span class="n">perl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">regmatches</span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [[1]]
## [1] "4/8/03"    "10-6-2004" "01-01-01"</code></pre></figure>

<h2 id="section-14">至少重复的次数</h2>
<p>使用{3,}表示至少重复3次</p>

<h2 id="section-15">单词边界</h2>
<p>使用\b表示单词的边界,\B表示不匹配边界</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">text</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"The cat scattered his foof all over the room"</span><span class="w">
</span><span class="n">m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gregexpr</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"cat"</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">text</span><span class="p">)</span><span class="w">
</span><span class="n">regmatches</span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [[1]]
## [1] "cat" "cat"</code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gregexpr</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"\\bcat\\b"</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">text</span><span class="p">)</span><span class="w">
</span><span class="n">regmatches</span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [[1]]
## [1] "cat"</code></pre></figure>

<h2 id="section-16">字符串边界</h2>
<p>使用乘方符号(^)和美元符号($)来表示首尾。</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">text</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"This is bad,real bad.  &lt;?xml version=\"1.0\"?&gt; "</span><span class="w">
</span><span class="n">m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gregexpr</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"\\s*&lt;\\?xml.*\\?&gt;"</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">text</span><span class="p">)</span><span class="w">
</span><span class="n">regmatches</span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [[1]]
## [1] "  &lt;?xml version=\"1.0\"?&gt;"</code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gregexpr</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"^\\s*&lt;\\?xml.*\\?&gt;"</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">text</span><span class="p">)</span><span class="w">
</span><span class="n">regmatches</span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">)</span><span class="w">  </span><span class="err">#这样可以检验出不合法的</span><span class="n">xml</span><span class="err">文档</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [[1]]
## character(0)</code></pre></figure>

<h2 id="section-17">分行匹配模式</h2>
<p>在分行模式下，还将匹配换行符后面的内容，使用分行模式需要使用(?m)来完成。</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">text</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">" %InLiNe_IdEnTiFiEr% \"#include&lt;stdio.h&gt;\"\n//ptrint Hello world\nint main()\n{\n//begin\nprintf(%,\"Hello world\");\nreturn 0;\n//end\n}\n"</span><span class="w">
</span><span class="n">m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gregexpr</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"^\\s*//.*$"</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">perl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">regmatches</span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [[1]]
## character(0)</code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gregexpr</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"(?m)^\\s*//.*$"</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">perl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">regmatches</span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [[1]]
## [1] "//ptrint Hello world" "//begin"              "//end"</code></pre></figure>

<h2 id="section-18">子表达式</h2>
<p>据一个例子来说明子表达式什么，比如我们处理”hellohellohello world hello world”这句话的时候我们想把其中的hello连在一起达到两次或者两次以上的字符串找出来，于是我们使用<code class="highlighter-rouge">hello{2,}</code>，但是发现出来的结果和我们想要的有很大的差距，因为表示次数的式子只对离着最近的一个字母起作用。我们想要达到预想的效果需要把hello当作是一个整体，这个时候我们就需要用到子表达式。</p>

<p>在正则表达式中，子表达式使用（）括起来就可以了，看下面的例子：</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">text</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"hellohellohello world hello world"</span><span class="w">

</span><span class="n">m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gregexpr</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"hello{2,}"</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">text</span><span class="p">)</span><span class="w">
</span><span class="n">regmatches</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [[1]]
## character(0)</code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gregexpr</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"(hello){2,}"</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">text</span><span class="p">)</span><span class="w">
</span><span class="n">regmatches</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [[1]]
## [1] "hellohellohello"</code></pre></figure>

<h3 id="section-19">子表达式的嵌套</h3>
<p>通过一个找出有效IP地址的例子中了解子表达式的嵌套，合法的IP必须满足数字小于255，我们看下面的例子:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">text</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"ping 167.42.223.4 and 56.256.2.3"</span><span class="w">
</span><span class="n">m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gregexpr</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"(((\\d{1,2})|(1\\d{2})|(2[0-4]\\d)|(25[0-5]))\\.){3}((\\d{1,2})|(1\\d{2})|(a[0-4]\\d)|(25[0-5]))"</span><span class="p">,</span><span class="w"> 
    </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">text</span><span class="p">)</span><span class="w">
</span><span class="n">regmatches</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [[1]]
## [1] "167.42.223.4"</code></pre></figure>

<h2 id="section-20">回溯引用</h2>
<p>回溯应用是对于子表达式来说的，简单的就是我们用一个符号来表示前面出现过的子表达式。通过下面的应用场合来了解，我们需要找出所有的标题：</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">text</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"&lt;BODY&gt;\n&lt;H1&gt; H1&lt;/H1&gt;\nBababallll~~~\n&lt;H2&gt; H2&lt;/H2&gt;\nmiaomimaomi~~~~~\n&lt;H3&gt; H3&lt;/H3&gt;\nwangwangwang~~~\n&lt;H4&gt; H4&lt;/H4&gt;\n&lt;BODY&gt;"</span><span class="w">

</span><span class="n">m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gregexpr</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"&lt;[hH][1-4]&gt;.*?&lt;/[hH][1-4]&gt;"</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">text</span><span class="p">)</span><span class="w">  </span><span class="c1">#懒惰型
</span><span class="n">regmatches</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="p">)</span><span class="w">  </span><span class="err">#貌似可以工作，但是不通用</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [[1]]
## [1] "&lt;H1&gt; H1&lt;/H1&gt;" "&lt;H2&gt; H2&lt;/H2&gt;" "&lt;H3&gt; H3&lt;/H3&gt;" "&lt;H4&gt; H4&lt;/H4&gt;"</code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gregexpr</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"&lt;[hH][1-4]&gt;.*&lt;/[hH][1-4]&gt;"</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">text</span><span class="p">)</span><span class="w">  </span><span class="c1">#贪婪型
</span><span class="n">regmatches</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [[1]]
## [1] "&lt;H1&gt; H1&lt;/H1&gt;\nBababallll~~~\n&lt;H2&gt; H2&lt;/H2&gt;\nmiaomimaomi~~~~~\n&lt;H3&gt; H3&lt;/H3&gt;\nwangwangwang~~~\n&lt;H4&gt; H4&lt;/H4&gt;"</code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gregexpr</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"&lt;[hH]([1-4])&gt;.*&lt;/[hH]\\1&gt;"</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">text</span><span class="p">)</span><span class="w">
</span><span class="n">regmatches</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [[1]]
## [1] "&lt;H1&gt; H1&lt;/H1&gt;" "&lt;H2&gt; H2&lt;/H2&gt;" "&lt;H3&gt; H3&lt;/H3&gt;" "&lt;H4&gt; H4&lt;/H4&gt;"</code></pre></figure>

<h2 id="section-21">回溯引用在替代中的使用</h2>
<p>直接看下面的例子:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">text</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"balabala~~~  gmail@gmail.com miaomiaomaio~~"</span><span class="w">
</span><span class="n">m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gregexpr</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"\\w+[\\w\\.]*@[\\w\\.]+\\.\\w+"</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">text</span><span class="p">,</span><span class="w"> 
    </span><span class="n">perl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">regmatches</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [[1]]
## [1] "gmail@gmail.com"</code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">sub</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"(\\w+[\\w\\.]*@[\\w\\.]+\\.\\w+)"</span><span class="p">,</span><span class="w"> </span><span class="n">replacement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"&lt;A HREF=\\\"mailto:\\1\\\"&gt;\\1&lt;/A&gt;"</span><span class="p">,</span><span class="w"> 
    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">perl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] "balabala~~~  &lt;A HREF=\"mailto:gmail@gmail.com\"&gt;gmail@gmail.com&lt;/A&gt; miaomiaomaio~~"</code></pre></figure>

<p>注意R中sub和gsub（sub的全局版本）函数的使用。下面再看一个对电话号码重新排序的问题：</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">text</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"324-245-2521\n324-255-6156"</span><span class="w">
</span><span class="n">text</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gsub</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"(\\d{3})(-)(\\d{3})(-)(\\d{4})"</span><span class="p">,</span><span class="w"> </span><span class="n">replacement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"\\(\\1\\) \\3-\\5"</span><span class="p">,</span><span class="w"> 
    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">perl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">cat</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## (324) 245-2521
## (324) 255-6156</code></pre></figure>

